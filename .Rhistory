install.packages(slidify)
install.packages("slidify")
install_github("slidify",'ramnathv')
install.packages("devtools")
library(devtools)
library(devtool)
install_github("slidify",'ramnathv')
library(httr)
library("devtools")
install.pakcages("devtools")
install.packages("devtools")
install.packages("Rcurl")
install.packages("RCurl")
install.packages("devtools")
install.packages("devtools")
library(devtools)
install.packages("devtools")
library(devtools)
install_github("slidify",'ramnathv')
install_github("slidifyLibraried",'ramnathv')
library(slidify)
author("slidify R-tutorial")
setwd("")
install.packages("mgcv")
library(mgcv) #provides functions for generalized additive modelling
dat1 <- readRDS("estate.rds")
setwd("~/slidify R-tutorial")
install_github("slidifyLibraries",'ramnathv')
install_github("slidifyLibraries",'ramnathv')
library(slidify)
library(slidifyLibraries)
dat1 <- readRDS("estate.rds")
g1  <- lm(log10(房價)~面積+車位+屋齡+型態, data=dat1)
dat1
colnames(dat1)
colnames(dat1) <- iconv(colnames(dat1),"UTF-8")
dat1 <- as.data.frame(apply(dat1,2,iconv,"UTF-8"))
dat1
header(dat1)
head(dat1)
dat1 <- readRDS("estate.rds","UTF-8")
head(dat1)
dat1 <- readRDS("estate.rds","big5")
head(dat1)
colnames(dat1) <- iconv(colnames(dat1),"ascii")
dat1 <- readRDS("estate.rds","ascii")
head(dat1)
dat1 <- readRDS("estate.rds","utf8")
head(dat1)
dat1 <- readRDS("estate.rds","UTF-8")
head(dat1)
iconv(dat1,"UTF-8")
View(dat1)
colnames(dat1)
library(slidify)
library(slidifyLibraries)
dat1 <- readRDS("estate.rds","UTF-8")
dat1 <- readRDS("estate.rds","UTF-8")
author("slidify R-tutorial")
dat1 <- readRDS("estate.rds","UTF-8")
colnames(dat1)
iconv(colnames(dat1),"utf8")
iconv(colnames(dat1),"big5")
dat1 <- readRDS("estate.rds","big5"")
)
dat1 <- readRDS("estate.rds","big5")
colnames(dat1)
colnames(dat1) <- iconv(colnames(dat1),"big5")
colnames(dat1)
dat1 <- as.data.frame(apply(dat1,2,iconv,"big5"))
head(dat1)
class(dat1$房價)
dat1$房價 <- as.numeric(dat1$房價)
dat1$面積 <- as.numeric(dat1$面積)
dat1$屋齡 <- as.numeric(dat1$屋齡)
g1  <- lm(log10(房價)~面積+車位+屋齡+型態, data=dat1)
g11 <- lm(log10(房價)~面積+車位+屋齡+行政區+型態, data=dat1)
g12 <- lm(log10(房價)~面積+車位+屋齡+縣市+型態, data=dat1)
#g13 <- lm(log10(房價)~面積+車位+屋齡+行政區+縣市+型態, data=dat1)
summary(g1)$adj.r.sq;summary(g11)$adj.r.sq;summary(g12)$adj.r.sq#;summary(g13)
# fit addiive model with two smooth terms
g2  <- gam(log10(房價)~s(面積)+車位+s(屋齡)+型態, data=dat1)
library(mgcv) #provides functions for generalized additive modelling
plot(g2, select=1, lwd=2)
g2  <- gam(log10(房價)~s(面積)+車位+s(屋齡)+型態, data=dat1)
plot(g2, select=1, lwd=2)
class(dat1)
colnames(dat1)
class(dat1$縣市)
class(dat1$行政區)
class(dat1$房價)
class(dat1$車位)
class(dat1$屋齡)
class(dat1$型態)
g1  <- lm(log10(房價)~log10(面積)+車位+屋齡+型態, data=dat1)
g11 <- lm(log10(房價)~log10(面積)+車位+屋齡+行政區+型態, data=dat1)
g12 <- lm(log10(房價)~log10(面積)+車位+屋齡+縣市+型態, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
g2  <- gam(log10(房價)~s(log10(面積))+車位+s(屋齡)+型態, data=dat1)
g21 <- gam(log10(房價)~s(log10(面積))+車位+s(屋齡)+行政區+型態, data=dat1)
g22 <- gam(log10(房價)~s(log10(面積))+車位+s(屋齡)+縣市+型態, data=dat1)
c(summary(g2)$r.sq,summary(g21)$r.sq,summary(g22)$r.sq)
plot(g2, select=1, lwd=2)
g2  <- gam(log10(房價)~s()+車位+s(屋齡)+型態, data=dat1)
g2  <- gam(log10(房價)~s(面積)+車位+s(屋齡)+型態, data=dat1)
plot(g2, select=1, lwd=2)
g2  <- gam(log10(房價)~s(面積)+車位+s(屋齡)+型態, data=dat1)
g21 <- gam(log10(房價)~s(面積)+車位+s(屋齡)+行政區+型態, data=dat1)
g22 <- gam(log10(房價)~s(面積)+車位+s(屋齡)+縣市+型態, data=dat1)
c(summary(g2)$r.sq,summary(g21)$r.sq,summary(g22)$r.sq)
abline(h=g1$coefficients[["面積"]], lwd=2, col=2)
g1$coefficients[["面積"]]
g1  <- lm(log10(房價)~面積+車位+屋齡+型態, data=dat1)
g11 <- lm(log10(房價)~面積+車位+屋齡+行政區+型態, data=dat1)
g12 <- lm(log10(房價)~面積+車位+屋齡+縣市+型態, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
plot(g2, select=1, lwd=2)
abline(h=g1$coefficients[["面積"]], lwd=2, col=2)
legend("topleft", c("Smooth term", "Linear term"), col=1:2, lty=1, lwd=2, bty="n")
plot(g2, select=2, lwd=2)
abline(h=g1$coefficients[["屋齡"]], lwd=2, col=2)
new <- dat1[1:6, c(2,3,4,6,7,12)]
dat1
dat1[1:6, c(2,3,4,6,7,12)]
dat1[1:6, ]
g1  <- lm(log10(房價)~面積+車位+屋齡+型態+管理, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
g1  <- lm(log10(房價)~面積+車位+屋齡+型態, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
+管理
g1  <- lm(log10(房價)~面積+車位+屋齡+型態+管理, data=dat1)
summary(g1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
g11 <- lm(log10(房價)~面積+車位+屋齡+行政區+型態+管理, data=dat1)
g12 <- lm(log10(房價)~面積+車位+屋齡+縣市+型態+管理, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
new <- dat1[1:6, c(1,3,5,6,7)]
rownames(new) <- 1:6
new$面積
new$面積 <- c(160,160,210,210,260,260)
new$車位 <- rep("有車位",6);
new$屋齡 <- rep(8, 6)
new$行政區 <- rep("大安區",6)
new$型態
new$型態 <- rep(c("透天","公寓","大樓"),2)
new$型態 <- rep(c("套房","公寓","大樓"),2)
tmp <- predict(g2, newdata=new, se.fit=TRUE)
new$車位 <- rep("車位",6);
new$車位
tmp <- predict(g2, newdata=new, se.fit=TRUE)
new <- dat1[1:6, c(1,3,5,6,7)]
new$車位
new <- dat1[1:6, c(1,3,5,6,7)]
rownames(new) <- 1:6
new$面積 <- c(160,160,210,210,260,260)
new$車位 <- rep("有",6);
new$屋齡 <- rep(8, 6)
new$行政區 <- rep("大安區",6)
new$型態 <- rep(c("套房","公寓","大樓"),2)
# prediction
tmp <- predict(g2, newdata=new, se.fit=TRUE)
pred <- 10^cbind(tmp$fit, tmp$fit-tmp$se.fit, tmp$fit+tmp$se.fit)
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]/10000),
"單價估計.萬元"=round(pred[,1]/10000/new$面積))
dat1$行政區
dat1$行政區(which(dat1$行政區=="大安區"))
dat1$行政區=="大安區"
which(dat1$行政區=="大安區")
dat1[which(dat1$行政區=="大安區"),]
new
pred <- 10^cbind(tmp$fit, tmp$fit-tmp$se.fit, tmp$fit+tmp$se.fit)
pred
new$面積
new$型態
tmp <- predict(g2, newdata=new, se.fit=TRUE)
pred <- 10^cbind(tmp$fit, tmp$fit-tmp$se.fit, tmp$fit+tmp$se.fit)
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]),
"單價估計.萬元"=round(pred[,1]/new$面積))
pred[,1]/new$面積
g2
summary(g2)
tmp <- predict(g21, newdata=new, se.fit=TRUE)
pred <- 10^cbind(tmp$fit, tmp$fit-tmp$se.fit, tmp$fit+tmp$se.fit)
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]),
"單價估計.萬元"=round(pred[,1]/new$面積))
g1  <- lm(log10(房價)~面積+車位+屋齡+型態, data=dat1)
g11 <- lm(log10(房價)~面積+車位+屋齡+行政區+型態, data=dat1)
g12 <- lm(log10(房價)~面積+車位+屋齡+縣市+型態, data=dat1)
#g13 <- lm(log10(房價)~面積+車位+屋齡+行政區+縣市+型態, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
plot(g2, select=1, lwd=2)
abline(h=g1$coefficients[["面積"]], lwd=2, col=2)
legend("topleft", c("Smooth term", "Linear term"), col=1:2, lty=1, lwd=2, bty="n")
plot(g2, select=2, lwd=2)
abline(h=g1$coefficients[["屋齡"]], lwd=2, col=2)
g11$coefficients[["面積"]]
plot(g21, select=1, lwd=2)
abline(h=g11$coefficients[["面積"]], lwd=2, col=2)
legend("topleft", c("Smooth term", "Linear term"), col=1:2, lty=1, lwd=2, bty="n")
plot(g21, select=2, lwd=2)
par(cex=1.2, mfrow=c(1,2))
plot(g21, select=1, lwd=2)
plot(g21, select=1, lwd=2)
plot(g21, select=1, lwd=2)
abline(h=g11$coefficients[["面積"]], lwd=2, col=2)
class(dat1$面積)
range(dat1$面積)
dat1 <- readRDS("estate.rds","big5")
colnames(dat1) <- iconv(colnames(dat1),"big5")
dat1 <- as.data.frame(apply(dat1,2,iconv,"big5"))
dat1$房價 <- as.numeric(dat1$房價)
dat1$面積 <- as.numeric(dat1$面積)
dat1$屋齡 <- as.numeric(dat1$屋齡)
g1  <- lm(log10(房價)~面積+車位+屋齡+型態, data=dat1)
g12 <- lm(log10(房價)~面積+車位+屋齡+縣市+型態, data=dat1)
g13 <- lm(log10(房價)~面積+車位+屋齡+行政區+縣市+型態, data=dat1)
g2  <- gam(log10(房價)~s(面積)+車位+s(屋齡)+型態, data=dat1)
g22 <- gam(log10(房價)~s(面積)+車位+s(屋齡)+縣市+型態, data=dat1)
g11 <- lm(log10(房價)~面積+車位+屋齡+行政區+型態, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
g21 <- gam(log10(房價)~s(面積)+車位+s(屋齡)+行政區+型態, data=dat1)
c(summary(g2)$r.sq,summary(g21)$r.sq,summary(g22)$r.sq)
range(dat1$面積)
plot(g21, select=1, lwd=2,xlim=c(0,120))
g21
c(summary(g2)$r.sq,summary(g21)$r.sq,summary(g22)$r.sq)
attributes(g21)
par(cex=1.2, mfrow=c(1,2))
plot(g21, select=1, lwd=2, xlim=c(0,120))
abline(h=g11$coefficients[["面積"]], lwd=2, col=2)
par(cex=1.2, mfrow=c(1,2))
plot(g21, select=1, lwd=2, xlim=c(0,120))
par(cex=1.2, mfrow=c(1,2))
plot(g21, select=1, lwd=2)#range(dat1$面積)
abline(h=g11$coefficients[["面積"]], lwd=2, col=2)
dat1[dat1$面積>1000,]
dat1 <- readRDS("estate.rds","big5")
colnames(dat1) <- iconv(colnames(dat1),"big5")
dat1 <- as.data.frame(apply(dat1,2,iconv,"big5"))
dat1$房價 <- as.numeric(as.character(dat1$房價))
dat1$面積 <- as.numeric(as.character(dat1$面積))
dat1$屋齡 <- as.numeric(as.character(dat1$屋齡))
range(dat1$面積)
sum(dat1$面積>300)
dat1<- dat1[dat1$面積<=300,]
g1  <- lm(log10(房價)~面積+車位+屋齡+型態, data=dat1)
g12 <- lm(log10(房價)~面積+車位+屋齡+縣市+型態, data=dat1)
g13 <- lm(log10(房價)~面積+車位+屋齡+行政區+縣市+型態, data=dat1)
g2  <- gam(log10(房價)~s(面積)+車位+s(屋齡)+型態, data=dat1)
g22 <- gam(log10(房價)~s(面積)+車位+s(屋齡)+縣市+型態, data=dat1)
g11 <- lm(log10(房價)~面積+車位+屋齡+行政區+型態, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
# fit addiive model with two smooth terms
g21 <- gam(log10(房價)~s(面積)+車位+s(屋齡)+行政區+型態, data=dat1)
c(summary(g2)$r.sq,summary(g21)$r.sq,summary(g22)$r.sq)
# Compare adjusted R-squared, 越趨近1模型配適度越好
data.frame("linear model"=summary(g1)$adj.r.sq, "additive model"=summary(g2)$r.sq)
par(cex=1.2, mfrow=c(1,2))
plot(g21, select=1, lwd=2)#range(dat1$面積)
abline(h=g11$coefficients[["面積"]], lwd=2, col=2)
legend("topleft", c("Smooth term", "Linear term"), col=1:2, lty=1, lwd=2, bty="n")
plot(g21, select=2, lwd=2)
abline(h=g1$coefficients[["屋齡"]], lwd=2, col=2)
```
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]),
"單價估計.萬元"=round(pred[,1]/new$面積))
dat1$屋齡
dat1$面積
dat1$房價
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]),
"單價估計.萬元"=round(pred[,1]/new$面積))
pred
pred <- 10^cbind(tmp$fit, tmp$fit-tmp$se.fit, tmp$fit+tmp$se.fit)
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]),
"單價估計.萬元"=round(pred[,1]/new$面積))
dat1$房價
g1  <- lm(log10(房價)~面積+車位+屋齡+型態, data=dat1)
g12 <- lm(log10(房價)~面積+車位+屋齡+縣市+型態, data=dat1)
g13 <- lm(log10(房價)~面積+車位+屋齡+行政區+縣市+型態, data=dat1)
g2  <- gam(log10(房價)~s(面積)+車位+s(屋齡)+型態, data=dat1)
g22 <- gam(log10(房價)~s(面積)+車位+s(屋齡)+縣市+型態, data=dat1)
g11 <- lm(log10(房價)~面積+車位+屋齡+行政區+型態, data=dat1)
c(summary(g1)$adj.r.sq,summary(g11)$adj.r.sq,summary(g12)$adj.r.sq)#;summary(g13)
# fit addiive model with two smooth terms
g21 <- gam(log10(房價)~s(面積)+車位+s(屋齡)+行政區+型態, data=dat1)
c(summary(g2)$r.sq,summary(g21)$r.sq,summary(g22)$r.sq)
# Compare adjusted R-squared, 越趨近1模型配適度越好
data.frame("linear model"=summary(g1)$adj.r.sq, "additive model"=summary(g2)$r.sq)
plot(g21, select=1, lwd=2)#range(dat1$面積)
abline(h=g11$coefficients[["面積"]], lwd=2, col=2)
legend("topleft", c("Smooth term", "Linear term"), col=1:2, lty=1, lwd=2, bty="n")
plot(g21, select=2, lwd=2)
abline(h=g1$coefficients[["屋齡"]], lwd=2, col=2)
new <- dat1[1:6, c(1,3,5,6,7)]
rownames(new) <- 1:6
new$面積 <- c(160,160,210,210,260,260)
new$車位 <- rep("有",6);
new$屋齡 <- rep(8, 6)
new$行政區 <- rep("大安區",6)
new$型態 <- rep(c("套房","公寓","大樓"),2)
# prediction
tmp <- predict(g21, newdata=new, se.fit=TRUE)
pred <- 10^cbind(tmp$fit, tmp$fit-tmp$se.fit, tmp$fit+tmp$se.fit)
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]),
"單價估計.萬元"=round(pred[,1]/new$面積))
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]/10000),
"單價估計.萬元"=round(pred[,1]/10000/new$面積))
plot(g21, select=1, lwd=2)#range(dat1$面積)
abline(h=g11$coefficients[["面積"]], lwd=2, col=2)
legend("topleft", c("Smooth term", "Linear term"), col=1:2, lty=1, lwd=2, bty="n")
plot(g21, select=2, lwd=2)
abline(h=g1$coefficients[["屋齡"]], lwd=2, col=2)
new <- dat1[1:6, c(1,3,5,6,7)]
rownames(new) <- 1:6
new$面積 <- c(160,160,210,210,260,260)
new$車位 <- rep("有",6);
new$屋齡 <- rep(8, 6)
new$行政區 <- rep("大安區",6)
new$型態 <- rep(c("套房","公寓","大樓"),2)
# prediction
tmp <- predict(g21, newdata=new, se.fit=TRUE)
pred <- 10^cbind(tmp$fit, tmp$fit-tmp$se.fit, tmp$fit+tmp$se.fit)
data.frame("建案坪數"=new$面積, "高低樓層"=new$型態,
"總價估計.萬元"=round(pred[,1]/10000),
"單價估計.萬元"=round(pred[,1]/10000/new$面積))
pred
g21
c(summary(g2)$r.sq,summary(g21)$r.sq,summary(g22)$r.sq)
